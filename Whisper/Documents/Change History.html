<HTML>

<HEAD>
   <TITLE>Whisper Change History</TITLE>
</HEAD>

<BODY>
	<H1><CENTER>Whisper Change History</CENTER></H1>

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 2.0</H2>
			</TH>
			<TD>
				<H2>March 16, 2001</H2>	
			</TD>
		</TR>
	</TABLE>
	
		<H4>General Notes</H4>
		<UL> 
			<LI>Instead of one monolithic framework Whisper is now divided into packages/framelets. This should make it easier to use
			just the parts of Whisper that you want to and should make it easier to port the lower level stuff to Unix.
			There are currently nine packages:</LI>
			<UL> 
				<LI>Runtime provides low level debugging support and a debugging wrapper around the compiler's operator new
				(this keeps track of stack crawls so it's significantly better than, say, DebugNew).</LI>
				<LI>Core provides quite a bit of stuff that most packages will use. This includes higher level debugging support
				for Design By Contract, unit tests, and logging, type-safe callback classes, threading classes, binary streams,
				Unicode utilities, etc.</LI>
				<LI>Files provides has a nice set of classes for dealing with files and also includes an open-ended resource
				manager that allows you to use URIs to specify where the resource lives.</LI>
				<LI>Graphics provides shape classes for drawing things like lines, rectangles, bitmaps, and text. It also includes
				PNG import and export classes.</LI>
				<LI>Quesa includes a set of C++ wrappers for QD3D/Quesa that automatically handle error handling and reference
				counting. These are light-weight classes that take very little overhead, but significantly clean up and improve
				QD3D code.</LI>
				<LI>Parsing provides a simple parsing class, a more complex suite of classes for building custom recursive
				descent parsers (these are modeled after those in Eiffel's library), and a regular expression class.</LI>
				<LI>XML Parser provides a full blown validating XML parser.</LI>
				<LI>COM works more or less like Microsoft's COM except that reference counting is automated with a smart pointer 
				class, exceptions are used to propagate errors, strings are used instead of GUIDs, interfaces are grouped into
				larger entities called "bosses", and plugins can add interfaces to existing bosses as they load.</LI>
				<LI>UI provides the standard things like windows, dialog, push buttons, checkboxes, etc. These are now all done
				using the COM package. Among other things this means that there is no more implementation inheritance when clients
				customize these classes.</LI>
			</UL>
		</UL> 

		<H4>Known Bugs</H4>		
		<UL> 
			<LI>XRegularExpression doesn't work properly with Unicode ('.' and "[^a-z]" 
			  still won't match Unicode characters with values greater than 255).</LI>

			<LI>Win</LI>
			<UL> 
				<LI>Disabled ObscureCursor on Windows (the old code had a dependency on XCommand which doesn't fly
				    now that the package dependencies have been tightened up).</LI>
				<LI>The stack crawl doesn't have symbols in MSVC 6 (MFC's AfxDumpStack has the same problem).
					However you can use the map file to figure out where your leaks are.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
				<LI>I haven't tried Quesa yet on Windows.</LI>
				<LI>Window maximizing is still goofy.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
				<LI>When building debug DLL targets you'll run into some MSL problems (with Pro 6.0 and 6.1):
				<UL> 
					<LI>In <ostream> at line 1335 there's an operator<< function overloaded for const char*'s.
	  				In the else case of _MSL_NO_LOCALE there's a call to widen(). This should read
	 				 out.widen.</LI>
					<LI>In <locale> at line 8458 there's a function called numput. Instead of creating a 
	 				static string it needs to create a basic_string<charT, char_traits<charT>, allocator<charT> >.
	  				Instead of casting 0 to (const char*) it needs to cast to (const charT*).</LI>
				</UL> 
			</UL>
		</UL>

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Changed XColorTable::DoCompare so that it actually works and is more efficient.</LI>
			<LI>Floating point conversion unit test no longer hard codes the decimal point char.</LI>
			<LI>XURI::GetFile works if the path is a root level file (fix from Thomas Powers).</LI>
			
			<LI>Mac</LI>
			<UL> 
				<LI>GetFontStyleRecord only sets the fore color flag if the color isn't black (so static text controls properly dim when deactivated).</LI>
				<LI>XDisplay sanity checks no longer assert for 0 Hz refresh rate (LCDs).</LI>
				<LI>Fixed a bogus assert in the MAEDesc (DescType, const void*, uint32) ctor.
				<LI>Fixed the FragInit prototype.</LI>
			</UL> 
			
			<LI>Win</LI>
			<UL> 
				<LI>Tweaked the RGB and RGBA PNG import code.</LI>
				<LI>XColorTable ctor no longer asserts that numColors is a power of 2.</LI>
				<LI>Fixed an off-by-one-error in XLineShapeDraw (XPoint, XSize).</LI>
				<LI>XProcessFiles calls CoInitialize (need to do this for every thread that uses files).</LI>
				<LI>XFileSpec::HasMetaData and SetMetaData no longer throw on FAT file systems.</LI>
				<LI>XFileSystemSpec(XFolderSpec, wstring) ctor now works if the string points to a shortcut.</LI>
				<LI>Fixed XFileSystem::IsFAT.</LI>
				<LI>Fixed GetUserName and GetComputerName so they return more than just the first
  				character of the name.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 			
			<LI>Got rid of XString (use std::wstring instead).</LI>
			<LI>XError now assumes the error message is UTF-8 instead of a platform string.</LI>
			<LI>Renamed IWindow::SendToBack MoveToBack.</LI>
			<LI>Tweaked the XML Compiler so that it checks for XXMLException's for better error reporting.</LI>
			<LI>Tweaked the XML parser so that it reports line numbers for attribute names that aren't in the DTD.</LI>
			<LI>Improved the error message in the event transcoding the XML fails.</LI>
			<LI>Added a XPixMapShape::Draw method that takes a clip region.</LI>
			<LI>XPixMap::GetPixelAt and SetPixelAt handle 24-bit images.</LI>
			<LI>XRGBColor color values are no longer clamped to [0.0, 1.0]. Added Normalize.</LI>
			<LI>Renamed XImageSink XBaseImage. Renamed XImageSource XImageImporter, XPNGImageSource
  				XPNGImporter, MPictImageSource MPictImporter, and WBMPImageSource WBMPImporter.</LI>
			<LI>Added a templatized XXMLAttribute ctor and Get and Set methods that overloaded ToStr and FromStr functions.
  				This makes custom types a lot nicer to handle.</LI>
			<LI>Renamed MenuCommand XMenuCommand.</LI>
			<LI>XFileSystem::GetTempFile takes an extension argument.</LI>
			<LI>XFileSystem::GetTempFile increments the time instead of getting it anew each time through the loop.</LI>
			<LI>Added an XColorTable ctor that takes an XXMLElement and a CreateElement method.</LI>
			<LI>Rewrote COMPILE_CHECK using a template (looks cooler and provides a better error message).</LI>
			<LI>Removed TRACE_IF and TRACEFLOW_IF.</LI>
			<LI>UNUSED is now in the global namespace.</LI>
			<LI>DEBUGSTR, TRACE, and TRACEFLOW are now in the global namespace.</LI>
			<LI>DEBUGSTR and TRACE are now rely on overloaded ToStr functions. So, instead of:
			    <PRE>
TRACE(L"area = (%d, %d, %d, %d)\n", area.left, area.top, area.right, area.bottom);</PRE>
  				you can use:
  				<PRE>
TRACE("area = ", area, "\n");</PRE>
  				(You can also use wide strings of course). I first tried using iostreams, but this caused crazy
  				amount of bloat in object files (although the linker stripped most of it out).</LI>
			<LI>TRACEFLOW now uses char*'s (instead of wchar_t*'s).</LI>
			<LI>SStateMessage is an XAnyValue instead of a const void*.</LI>
			<LI>Added XFileSpec::HasMetaData.</LI>
			<LI>Replaced the smart pointer IsValid methods with a const void* conversion operator.</LI>
			<LI>Renamed the callback adaptor functions Bind. Removed the Procedure callback adaptors.</LI>
			<LI>Instead of specializing selected algorithms for POD types, the new MSL mechanism to declare POD types is used.</LI>
			<LI>Replaced int16_cast, uint32_cast, etc with numeric_cast<T>.</LI>
			<LI>Switched to using png 1.0.9</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>Outlined ThrowIfNil (saves 76 bytes per call).</LI>
				<LI>Rewrote IsLowLevelDebuggerPresent using Apple's Debugging.h</LI>
				<LI>ThrowIfNil only throws an out of memory exception if MemError says we're out of memory.</LI>
				<LI>Fixed XPixmapShape so that it works better with transparent draw mode.</LI>
				<LI>Added a flag to PrepCopyBits to prevent changing the background color (useful for transparent draw mode).</LI>
			</UL> 
			
			<LI>Win</LI>
			<UL> 
				<LI>Dialogs now support help using HtmlHelp.</LI>
				<LI>Debug alerts are now displayed from within a thread so that the thread that 
	  				caused the debug call can be suspended.</LI>
				<LI>Instead of always popping up an alert BreakStrToDebugger calls OutputDebugString
	  				and breaks into the debugger (if one is running). This means that the text for
	 				ASSERTs is saved in the debugger output window and all the app's threads are
	  				suspended while you're looking at the message.</LI>
				<LI>Rewrote the XPreference code to use ToStr and FromStr functions instead of XNumericConversions.
  					Renamed the macro from NUMERIC_PREF to STREAMABLE_PREF.</LI>
				<LI>Disabled the close command in the Windows console window (kills the app).</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added ToUTF8Str, ToPlatformStr, ToPascalStr, and ToCarbonStr to convert from Unicode.</LI>
			<LI>Added FromPlatformStr, FromUTF8Str, FromAsciiStr, FromPascalStr, and FromCarbonStr to convert to Unicode.</LI>
			<LI>Added a class called XAnyValue. This is a non-template class that uses member
 			 	templates to store and get arbitrary value types. IDocument uses this when broadcasting
  				changed messages.</LI>
			<LI>Added XPNGExporter.</LI>
			<LI>Added FormatAsXML and FormatAsHTML (escapes chars like '&lt;').</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>Added MPicture (PicHandle wrapper).
			</UL> 
		</UL> 
	

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 2.0d3</H2>
			</TH>
			<TD>
				<H2>July 31, 2000</H2>	
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>		
		<UL> 
			<LI>XRegularExpression doesn't work properly with Unicode ('.' and "[^a-z]" 
			  still won't match Unicode characters with values greater than 255).</LI>

			<LI>Win</LI>
			<UL> 
				<LI>Disabled ObscureCursor on Windows (the old code had a dependency on XCommand which doesn't fly
				    now that the package dependencies have been tightened up).</LI>
				<LI>The stack crawl doesn't have symbols in MSVC 6 (MFC's AfxDumpStack has the same problem).
					However you can use the map file to figure out where your leaks are.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
				<LI>I've been having some problems building DLL versions of the projects on Windows. For now they won't work.</LI>
				<LI>I haven't tried Quesa yet on Windows.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
			</UL>
		</UL>

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>DoubleToFormStr now allows decPlaces of 0.</LI>
		</UL> 
		
		<H4>Changes</H4>
		<UL> 			
			<LI>Added yet another XInterfacePtr ctor to query for an interface on a specified XImplementation
                (this comes in handy with duplicate aggregated interfaces, see XInterfacePtr.h for an example).</LI>
			
			<LI>Mac</LI>
			<UL> 
			    <LI>Tweaked MFileSystem::GetVolumeTotalBytes and GetVolumeFreeBytes for the 3.3 Universal Headers.</LI>
			    <LI>XControlConstants.h includes ControlDefinitions.h when using the 3.3 Universal Headers.</LI>
			</UL> 
		</UL> 
	

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 2.0d2</H2>
			</TH>
			<TD>
				<H2>July 22, 2000</H2>	
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>		
		<UL> 
			<LI>XRegularExpression doesn't work properly with Unicode ('.' and "[^a-z]" 
			  still won't match Unicode characters with values greater than 255).</LI>

			<LI>Win</LI>
			<UL> 
				<LI>Disabled ObscureCursor on Windows (the old code had a dependency on XCommand which doesn't fly
				    now that the package dependencies have been tightened up).</LI>
				<LI>The stack crawl doesn't have symbols in MSVC 6 (MFC's AfxDumpStack has the same problem).
					However you can use the map file to figure out where your leaks are.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
				<LI>I've been having some problems building DLL versions of the projects on Windows. For now they won't work.</LI>
				<LI>I haven't tried Quesa yet on Windows.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>I've included a first cut at a UI package that uses COM-style objects. It currently includes classes for drag and drop
			apps, commands, undo actions, a few simple controls, windows, events, menus, and persistence. Note that the undo,
			menu, and persistence code has had little to no testing.</LI>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Fixed a couple of names in kCrayolaTable: "Red" wasn't capitalized and "Sky Blue" was missing 
  			the "S".</LI>
		</UL> 
		
		<H4>Changes</H4>
		<UL> 			
			<LI>Added some new features to the COM package:</LI>
				<UL> 
					<LI>A boss can now have multiple instances of the same interface (this is how extension objects are implemented).
					Note that you cannot query for an duplicated interface in the usual way. You have to use the XInterfacePtr ctor
					that takes an XBoss::iterator.</LI>
					<LI>Interfaces can now be added and removed at runtime (this allows extension objects to be dynamicly changed).</LI>
					<LI>Implementation classes can now implement multiple interfaces. This is transparent to clients, but can make
					the interface design more sensible and can make the implementations much nicer.</LI>
					<LI>The Bosses.XML files now allow the target to specified (eg "release", "debug", etc).</LI>
					<LI>The format and semantics of the Bosses.XML files has changed quite a bit. Bosses can now inherit interfaces
					from other bosses, there's support for abstract bosses, new interfaces replace existing interfaces, and a Group
					element has been added for interfaces that should be duplicated. Also you can add new interfaces to an existing
					boss (useful for plugins).</LI>
				</UL> 
			<LI>Removed XInterfacePtr::Reset.</LI>
			<LI>Removed XInterfacePtr and XConstInterfacePtr::operator*.</LI>
			<LI>Added XInterfacePtr ctors that take raw pointers (so you can do a qeury using 'this').</LI>
			<LI>Implementation class ctors now take an XBoss ctor (this allows the ctor to query for other
 			 interfaces on the boss).</LI>
			<LI>XImplementation will assert if someone tries to query for an interface as it's being constructed.</LI>
			<LI>XBoss::GetInterface returns nil if the boss is being torn down. This allows interfaces that
 			 are dynamicly added and removed to safely query for other interfaces in their dtors.</LI>
			<LI>Added XUnknown::mBreakOnRefs to break into the debugger when the ref count changes.</LI>
			<LI>Added support for disabling TRACE sinks.</LI>
			<LI>Renamed XCriticalSection::Enter Lock, renamed Leave Unlock.</LI>
			<LI>Made the XString char* ctors explicit. Removed most of the methods that took char*'s.</LI>
			<LI>bXML files are now cross platform.</LI>
			<LI>Added XDesktop::GetClientArea.</LI>
			<LI>Added BytesToStr to XIntConversions.h.</LI>
			<LI>Built a new copy of the Unicode tables using the Unicode 3.0 character database.</LI>
			<LI>XFont XML element defaults to "system" instead of "small system".</LI>

			<LI>Win</LI>
			<UL> 
				<LI>Added WSystemInfo::IsWin2000.</LI>
				<LI>If the path passed into ResolveShortcut doesn't point to a file or a shortcut ResolveShortcut 
				  will check to see if there's a shortcut file with that name in the directory.</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>XFileIterator::DoAdvance no longer uses recursion (it took too much stack space with deeply
			  	nested folder hierarchies).</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added the UI package.</LI>
			<LI>Added a Cookbook.html file (currently this only includes a recipe for creating a new drag and drop app).</LI>
		</UL> 


	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 2.0d1</H2>
			</TH>
			<TD>
				<H2>???</H2>	
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>		
		<UL> 
			<LI>XRegularExpression doesn't work properly with Unicode ('.' and "[^a-z]" 
			  still won't match Unicode characters with values greater than 255).</LI>

			<LI>Win</LI>
			<UL> 
				<LI>Disabled ObscureCursor on Windows (the old code had a dependency on XCommand which doesn't fly
				    now that the package dependencies have been tightened up).</LI>
				<LI>the stack crawl doesn't have symbols in MSVC 6 (MFC's AfxDumpStack has the same problem).
					However you can use the map file to figure out where your leaks are.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
				<LI>I've been having some problems building DLL versions of the projects on Windows. For now they won't work.</LI>
				<LI>I haven't tried Quesa yet on Windows.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>The Whisper packaging has changed for this release. Instead of one monolithic static library Whisper consists
			    of eight libraries in the backend and one frontend (UI) library. The backend libraries are Runtime, Core, Files,
			    Parsing, Quesa, Graphics, COM, and the XML Parser. Each library can be built as either a static library or a DLL.</LI>
			<LI>Ported to Pro 5.2</LI>
			<LI>For now I'm not including MSVC projects.</LI>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>XURIResolver::RemoveFetcher actually removes the fetcher from the list.</LI>
			<LI>Made XCountedPtr thread safe.</LI>
			<LI>Rewrote ZConvertRegExpr so that it works a bit better with Unicode (however '.' and "[^a-z]" 
			  still won't match Unicode characters with values greater than 255).</LI>
			<LI>Made XScanner's whitespace code Unicode savvy.</LI>
			<LI>I've started using the Oasis conformance suite to test the XML parser. This suite does a much better
			    job of testing validating parsers than the suite I had used before. I wound up fixing a number of 
			    problems:</LI>
					<UL> 
						<LI>Fixed a bug in XXMLLexer::ReadToken that could cause it to drop into an infinite loop with invalid parameter references.</LI>
						<LI>Declarations like "<!ELEMENT c (a,b)?>" are parsed correctly (old code required a space
		  					between the '?' and the '>').</LI>
						<LI>Declarations like "(#PCDATA)*" are correctly handled. </LI>
						<LI>Rewrote DoParseIgnoreSectionContents (old version wasn't quite right).</LI>
						<LI>Fixed the tests for extra tokens at the end of a file so they work if there's only one extra token.</LI>
						<LI>ZAttributeValueParser::Validate now validates attributes declared as #IMPLIED.</LI>
						<LI>Fixed the stand-alone validity check for normalized attributes.</LI>
						<LI>Children of ANY elements must be declared.</LI>
						<LI>ZPublicIDParser::Parse correctly normalizes carriage returns and line feeds.</LI>
						<LI>ZAttributeValueParser::Parse normalizes whitespace included via entities.</LI>
						<LI>Standalone documents are now OK if there are un-referenced external entities.</LI>
						<LI>ZContentParser::DoParseCDSection doesn't allow white-space to appear inside element content if the doc is stand-alone</LI>
						<LI>Fixed ZCommentParser::Parse so that "-->" is recognized when there's no white space before the token.</LI>
						<LI>Tweaked the XML parser's process instruction code to allow targets like "xml-stylesheet".</LI>
						<LI>Added support for euc-jp, and shift-jis language encodings (Mac only).</LI>
					</UL> 
			<LI>XIOU::Fulfill, Cancel, and Abort now unlock the semaphore after calling the callback object
			  (old code could allow the XIOU object to get destructed before the callback got a chance to execute).</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>The XFolderSpec ctor that takes a volume and directory id will now throw if dirNFErr or fnfErr is returned.</LI>
				<LI>Fixed a bug that could cause XFileSystem::GetValidName to index past the end of the file 
				  name if the number of characters to drop was odd.</LI>
				<LI>Fixed the XSaveReply copy ctor and assignment operator so that mCreator is correctly copied.</LI>
				<LI>IsDebuggerPresent was testing to see if IsLowLevelDebuggerPresent was nil instead of making 
				  a function call.</LI>
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>XFileSystem::GetValidName uses three periods instead of the bogus L"É" when the name has to 
				  be shortened.</LI>
				<LI>XFileSystem::DeleteFolder sets the current directory before calling RemoveDirectory.
				  (RemoveDirectory will return a weird error message if you attempt to delete the current directory)</LI>
				<LI>XPixMap creates a top-down pixmap.</LI>
				<LI>Tweaked XLineShape::Draw (XDrawContext, XPoint, XSize, XPen) so that it doesn't draw an extra pixel.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 			
			<LI>XXMLDoc::Save returns true if the XML was re-parsed.</LI>
			<LI>Added XXMLElement::RemoveAttribute, RemoveItem, and DeleteItem.</LI>
			<LI>Moved the notation and unparsed entity stuff from XXMLDTD to XXMLDoc.</LI>
			<LI>Added XXMLCallbackMixin::OnUnparsedEntity and OnNotation.</LI>
			<LI>When flattening binary objects the streaming code only writes out the class names once. If
			  the class name is streamed out again an index into a lookup table is written instead (this
			  doesn't break old streamed files).</LI>
			<LI>XFileSpec::ReadMetaData has been renamed GetMetaData and SaveMetaData has been renamed
			  SetMetaData. All of these will now throw (GetMetaData used to return true and false and
			  SaveMetaData used to eat all errors).</LI>
			<LI>Added XFileSystemSpec streaming methods (this is especially handy when using XPreference
			  to save file/folder locations).</LI>
			<LI>Added XThread::InMainThread.</LI>
			<LI>Unit tests are now grouped into suites and descend from XUnitTest.</LI>
			<LI>Rewrote the callback and closure classes so they rely on templatized ctors instead of global
			  factory functions.</LI>
			<LI>Replaced XClosure with adaptor functions (these convert a callback with n arguments to
			  a callback with m arguments (where m < n)</LI>
			<LI>MGrowZone uses XFunction2 objects instead of C function pointers when registering purge hooks.</LI>
			<LI>Instead of making Random a template function a few overloads are used. Random uses the 
			  Mersenne Twister instead of the code from Knuth. Note that std::rand is 3.8x faster than 
			  Random(int32) and 1.3x faster than Random(double) (if scalb is used when converting std::rand's 
			  result to a double). And the twister is slightly faster than the code from Knuth I was using.</LI>
			<LI>Automata code no longer requires a max symbol (this makes it easier for the XML parser to
			  validate documents with lots of distinct elements).</LI>
			<LI>XString::operator== and != use memcmp instead of XString::compare.</LI>
			<LI>All targets now use an inline depth of 7.</LI>
			<LI>Fixed most of the un-inlined inline methods. Note that this includes tweaking the ASSERT macro
			  so that it no longer forces methods to be outlined.</LI>
			<LI>Added LoadWhisperString and LoadAppString overloads (for better code generation).</LI>
			<LI>Tweaked the XML parser's exception code to produce better code and use less stack space
			  (ZGeneralReferenceParser for example uses 75% less stack space than the old code and the
			  Oasis conformance suite parses with a stack size of 100K).</LI>
			<LI>XAverageTimer dtor uses BreakStrToDebugger instead of DEBUGSTR.</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>Moved LaunchApp code from MProcess to MDesktopMgr.</LI>
				<LI>Rewrote MSystemInfo::GetAppRefNum to use FSpOpenResFile instead of CurResFile.</LI>
				<LI>XAverageTimer uses FastTiming instead of the Time Manager.</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added support for a COM-like object model.</LI>
			<LI>Added QD3D/Quesa wrapper classes. These make QD3D much easier to use with very little performance hit.</LI>
			<LI>Added XLogFile (eliminates some duplicate code in XMemoryHeap.cpp and XTrace.cpp).</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>Added XShiftJISTranscoder and XEUCJPTranscoder (I'm not sure if these are actually working).</LI>
			</UL> 
		</UL> 


	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.3</H2>
			</TH>
			<TD>
				<H2>September 12, 1999</H2>	
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>		
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>MSVC 6 emits weird compiler errors when Rich Hickey's callback objects are used with
  					static member functions, but only when the callback is created inside a member of the static
  					member's class.</LI>
				<LI>XScrollableControl doesn't properly draw nested controls. (Fixing this isn't entirely
				  straight forward: see Design Notes.txt for more details)</LI>
				<LI>the stack crawl doesn't have symbols in MSVC 6 (MFC's AfxDumpStack has the same problem).
					However you can use the map file to figure out where your leaks are.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
				<LI>Whisper maximizes windows differently than other Windows applications I've
				  looked at: if the window has a maximum size the window is grown to that size
				  instead of to fill the entire monitor. IMO this is way better than filling
				  an entire monitor with completely useless dead space, but the size grip and
				  the resize borders don't work when the window is maximized. I haven't been
				  able to find an app that sensibly maximizes windows so I'm not sure if this
				  is a Whisper bug or an OS limitation.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>XTabControl may not work with AM 1.0.1. It relies on the kControlTabInfoTag constant.
  					The 3.2 Universal Headers say this is present in AM 1.0.1, but I've had a report saying
  					that this isn't true. The only workaround I can see is awfully ugly...</LI>
				<LI>Command-Right-Arrow moves the cursor to the start of the next line instead of the end
  					of the current line. Tech note TE 18 describes how to hack TextEdit so that it does the
  					right thing, but this code no longer seems to work in OS 8.5.1: the cursor moves to the
 			 		right location, but bits of the old cursor are left behind.</LI>
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
				<LI>Controls inside tab controls aren't drawn in gray when disabled or deactivated (this is yet another AM 1.1 bug).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>Whisper has been compiled with CodeWarrior 5 and MSVC 6. For MSVC 6 be sure to get the latest
				service pack and the <A HREF="http://www.dinkumware.com/vc_fixes.html">Dinkumware STL patches</A>.
				I've also included CodeWarrior 4 projects which seem to work on Macs and should also work on Windows.
				MSVC 5 should also still work, but I haven't verified this (you'll need the Dinkumware patches with
				this as well).</LI>
			<LI>Windows and controls may now be streamed in and out using XML. To
			    jump start the process I've added an XFlattenWindowExtension debug extension that will stream the front
			    window out as an XML file. Once you have the XML you can create the window/control by, for example calling
			    one of the following XBaseWindow methods:</LI>
			    <PRE>
	static XBaseWindow* Create(const XXMLDoc& doc, const XString& id, XCreateByNameMixin* parent);
	static XBaseWindow* Create(const XURI& uri, const XString& id, XCreateByNameMixin* parent);</PRE>
				Here's an example of what the XML looks like for IconEdit's custom control:
			    <PRE>
	&lt;CIconControl
		style = "WS_CHILD+WS_VISIBLE+SS_OWNERDRAW+SS_NOTIFY"
		proc_id = "kControlUserPaneProc"&gt;
		&lt;XControlInfo
			name = "Image"
			location = "0 0"
			size = "224 224"
			bind_left = "true"
			bind_right = "true"
			bind_top = "true"
			bind_bottom = "true"
			visible = "true"
			enabled = "true"
			help_mesg = "Click to toggle cells on and off. Command click to get a context sensitive menu."
			disabled_help = ""
			draw_outset = "0"
			help_id = "0"/&gt;
	
		&lt;XUserControlInfo
			wants_focus = "true"/&gt;
	
		&lt;XScrollableControlInfo
			adjust_origin = "true"
			reconcile_overhang = "true"/&gt;
	&lt;/CIconControl&gt;</PRE>
				Note that if you are directly creating a custom control or window you'll need to create a DTD so
				that the XML parser knows that your id attribute is an ID. (You can look at IconEdit for an
				example of how to do this).
			<LI>I've also made some changes to XApplication and XXMLDoc to avoid parsing
				the XML for menus and windows/controls in release builds. This is done by adding an extra step
				to the debug targets: the XML is parsed normally and then the XXMLDoc is saved using a binary
				stream. Both the debug and release targets use the saved XXMLDoc to unflatten the objects (although
				typically release builds will use a resource uri instead of a file uri). This will usually provide
				a substantial speed boost and, for most app's, will allow the linker to dead strip the XML parser 
				which substantially reduces the size of release builds.
				
				<P>XApplication and XXMLDoc do a number of things to make this happen. The first is that in debug builds 
				XApplication now contains XFolderSpec's for the app's XML folder, the app's binary XML folder, and 
				the corresponding Whisper folders. This is information that will be needed for every app that wants
				to avoid parsing XML in release builds and it allows XApplication to automatically load the string tables.
				
				<P>The second is that XXMLDoc's can now be saved using a binary stream and XXMLDoc includes a new
				member called Save that parses an XML file and saves the resulting XXMLDoc using a specified XFileSpec.
				This makes it possible to skip the parsing of any XML that's not intended to be end-user editable.
				Here's an example of how this plays out:
			    <PRE>
	XDocument* CApplication::OnCreateNewDoc()
	{
		CDocument* doc = new CDocument;
		
	#if DEBUG
		// Each time we need to create a window we'll check the Windows.xml
		// file to see if it needs to be re-parsed. This is a bit inefficient
		// since the file needs to be loaded so that the CRC can be computed,
		// but it allows us to make changes to the file while the app is
		// running.
		XFileSpec inSpec  = XFileSpec(mAppXMLFolder, L"Windows.xml");
		XFileSpec outSpec = XFileSpec(mAppBinFolder, L"Windows.bXML");
		
		XXMLDoc::Save(inSpec, outSpec);
	
		XURI uri(outSpec);												// can't use the resource-based URI because it may not have been created yet
	#else
		XURI uri(L"resource://Windows.bXML");
	#endif
	
		(void) XDocWindow::Create(doc, uri, L"MainWindow");
		
		return doc;
	}</PRE>
				</LI>
				<LI>Added Carbon support. Note that the Carbon libraries are still at an early stage and there are a
				    number of problems:</LI>
					<UL> 
		  				<LI>XCursorUtils::GetPosition needs a better implementation.</LI>
		  				<LI>Disabled XCursorUtils::MoveTo and MoveBy on Carbon. (Currently Carbon doesn't provide a way to implement these).</LI>
		  				<LI>Disabled balloon help in menus (Carbon is supposed to have a new help system)</LI>
		  				<LI>Whisper::MenuCommand conflicts with a new type in the Universal Headers. This isn't a problem
		  	  				unless you have a "using namespace Whisper;" declaration in your app. If you do have one of these
		  	  				you can use the new XMenuCommand typedef.</LI>
		  				<LI>Disabled two MoreFiles routines: HGetVInfo and RestoreDefault.</LI>
		  				<LI>AmIBeingMWDebugged seems to crash...</LI>
		  				<LI>GetClip isn't working properly in XUserControl::DoDraw (the region is in global coordinates
		  	 	 			and seems to be incomplete). For now, I've hacked DoDraw so that it always draws the
		  	  				entire control in Carbon builds.</LI>
		  				<LI>Scrollable controls don't draw correctly if they're scrolled. This seems to be due to
		  	  				the user control's buggy clip region code.</LI>
		  				<LI>IsHandleValid (new Memory Manager call) fails for handles allocated in temp memory</LI>
					</UL>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Fixed a bug in ZStringTableBuilder that could have caused a valid translation to be skipped 
  				if there were multiple translations with different languages, but the same region code.</LI>
			<LI>XXMLDTD::DoGetSymbol no longer returns '|' (this caused problems with large DTD's).</LI>
			<LI>XXMLDocumentCallback::OnAttribute properly handles #IMPLIED IDs.</LI>
			<LI>XXMLPrintDoc no longer adds extra blank lines to character data.</LI>
 			<LI>ZElementParser::Parse issues a warning instead of throwing for undeclared elements (this is per section 3.2 of the standard).</LI>
			<LI>XFileType::Match no longer tries to match empty extensions.</LI>
			<LI>XTree::RemoveChild subtracts instead of adding delta to mCount.</LI>
			<LI>Fixed several bugs in XString::swap.</LI>
 			<LI>Rewrote CHECK_INVARIANT so that it's only one statement (so CHECK_INVARIANT does the right
 			    thing in if statements).</LI>
			<LI>Muscle's CProgressWindow uses an XClosureExtension clickCount of 0 instead of 1 with the 
  				indeterminate checkbox so double clicks now execute the extension twice instead of only once.</LI>

			<LI>Mac</LI>
			<UL> 
				<LI>Tweaked code in MBaseWindow.cpp to handle windows without drag regions.</LI>
				<LI>XToolWindow::OnReadData was using the wrong resource type when calling ReadResource.</LI>
				<LI>Fixed several bugs in XStateBroadcaster::DoAEDeviceChanged.</LI>
				<LI>XApplication::DoAEIdle, DoAEFilter, and DoAEQuitApp trap exceptions.</LI>
				<LI>XUserControl::DoDraw and DoFocus trap exceptions.</LI>
				<LI>XControl::GetObject only calls GetControlPropertySize if System 8.5 or better.</LI>
				<LI>XControl::Invariant only calls IsValidControlHandle if System 8.5 or better.</LI>
				<LI>kControlPushButtonCancelTag is only used with AM 1.1.</LI>
				<LI>SetControlProperty is no longer used on systems below Mac OS 8.5</LI>
				<LI>GetControl32BitValue and SetControl32BitValue are only used if AM 1.1 is present.</LI>
				<LI>XListBoxControl adjusts the cell width after resizing (the Appearance Manager is too lame to
  					do this for us).</LI>
				<LI>Implemented XSystemInfo::GetUserName on Macs.</LI>
				<LI>Corrected the MProfiler dtor numFunctions and stackDepth checks.</LI>
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>When throwing the XFileSpec and XFolderSpec ctors use the path argument instead of 
  				    calling GetName (GetName returns an empty string if the path is bogus).</LI>
				<LI>Changed OSVolume from an XChar to an XString and tweaked the file code so it should now work 
				    with networked volumes.</LI>
				<LI>Fixed a bad bug in the Unicode case of WRegistryKey::WriteString.</LI>
				<LI>Fixed some silly bugs in XKeyDownEvent::WasRepeating and XCharEvent::WasRepeating.</LI>
				<LI>EHatchBrush values weren't correct for XPen (EHatchBrush, XRGBColor, int32, EDrawMode) ctor.</LI>
				<LI>Rewrote XBrush::operator== so that it works better if the HBRUSH handles differ.</LI>
				<LI>Rewrote XPen::operator== so that it works better if the HPEN handles differ.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 
			<LI>Added XApplication::OnGetMenuBarURI. <STRONG>Note that you'll need to change your app's OnCreateDefaultMenuBar so that it calls OnGetMenuBarURI.</STRONG></LI>
			<LI>Worked on reducing app sizes (all these sizes are from Mac release builds):</LI>
				<UL> 
					<LI>36K from enabling "dead-strip static initialization code"</LI>
					<LI>IconEdit no longer includes WhisperDebug.r in release builds 74K</LI>
					<LI>string tables, menus, and controls are no longer parsed in release builds 200K</LI>
					<LI>WhisperStrings.xml is no longer included as a resource, instead a zipped binary stream
		  				is included 50K</LI>
					<LI>console.stubs.c is used instead of the SIOUX library in release builds 20K?</LI>
					<LI>Instead of hard-coding XPNGImageSource XBevelButtonControl looks up an XImageSource creator
		  				function using the URI's extension 80K</LI>
					<LI>IconEdit went from 1.2M to 692K, DropCount went from 920K to 544K</LI>
				</UL>
			<LI>XBaseDocument now has an undo context.</LI>
			<LI>XDocWindow uses the document's undo context.</LI>
			<LI>Removed XApplication::mGlobalUndoContext.</LI>
			<LI>Renamed XDialogBox::Validate ValidateData to avoid conflicting with XBaseWindow's Validate method.</LI>
			<LI>Renamed XTextBoxControl::Validate ValidateData to avoid conflicting with XControl's Validate method.</LI>
			<LI>Changed EWindowType and SWindowStyle to work better with Mac OS 8.5 (and Windows).</LI>
			<LI>Added XImageSource::Register, Unregister, and Create methods to create XImageSource's using the
  				XURI's extension.</LI>
			<LI>XBevelButtonControl and XPixMapControl use the new XImageSource::Create function so they can
  				now use image sources other than XPNGImageSource.</LI>
			<LI>XClickExtension subclasses use a default value of 0 for clickCount. (In general you should
  				only specify a clickCount for controls that special case double or triple-clicks).</LI>
			<LI>XXMLDoc's can now be saved using a binary stream.</LI>
			<LI>Added XXMLElement::FindAttribute and FindElement.</LI>
			<LI>XXMLPersistentMixin::HandleStreamOut and OnStreamOut XXMLDoc argument is no longer const.</LI>
			<LI>The XML parser does a better job of error reporting when the external subset cannot be found.</LI>
			<LI>XURIResolver::Resolve will try multiple fetchers if the first one can't resolve the uri.</LI>
			<LI>Added XInStream::GetCachedObject and XOutStream::GetCacheIndex.</LI>
			<LI>Moved XMultipleUndoableCommand into XUndoCommands.h</LI>
			<LI>ZStringTableBuilder will use the English translation if a better translation cannot be found.</LI>
			<LI>The XMenu::XMenu (XXMLDoc, XXMLElement) ctor will use the English translation if a better translation cannot be found.</LI>
			<LI>XMenu::DoFindEncoding replaces two underscores with an underscore (instead of two ampersands).</LI>
			<LI>XContextMenu's can now be created from XML resources.</LI>
			<LI>Added XFlattenWindowExtension (streams out the front window as an XML file).</LI>
			<LI>Added kSystemPref to XPreference (for prefs used across apps). This is only used on Win and Carbon.</LI>
			<LI>Added an ASSERT to the XURI (XString) ctor to check that file URI path's are absolute.</LI>
			<LI>XRGBColor::operator== uses a tolerance of 1/256 (instead of the default of 1.0e-6).
			<LI>XString::mDirty now contains three bit flags (for mCData, mPData, and mCFData). (This will provide a
			    minor speed improvement over the old code on Macs).</LI>
			<LI>Added default compare template argument to XSet.</LI>
			<LI>Added XDisplay::SetState(XDisplayState).</LI>
			<LI>DEFINE_STL_FUNCTIONS specializes copy_backward.</LI>
			<LI>XString::swap is now a friend function so it now acts as a specialization of std::swap
  				(however this doesn't do much good with either MSVC or MSL since their iter_swap's don't call swap).
			<LI>kPi is now computed using acos(-1.0). This should give us the value used by the math library.</LI>
			<LI>XMemoryHeap's list of allocated blocks is now circular so that XMemoryHeap::DumpLeaks can 
  				print the oldest blocks first (instead of last).</LI>
			<LI>Added release and profile targets to the CW 5 DropCount project.</LI>
			<LI>Replaced IconEdit's CInvertCommand, CSetColorCommand, and CZoomCommand with the new XUndoClosureCommand's.</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>I've changed the CW 5 Whisper project so that it uses CodeView instead of SYM files. I'd rather
					use SYM files since the debug information is stored outside the app, but the compiler kept 
					crashing when compiling STL code...</LI>
				<LI>The frame window's status bar window is now a status bar control (instead of a STATIC control)
  					and supports multiple sections.</LI>
				<LI>Win textboxes now default to using ES_AUTOVSCROLL and ES_MULTILINE.</LI>
				<LI>The WM_KILLFOCUS case in XTextBoxControl::HandleMessage only zaps the selection if ES_NOHIDESEL style isn't used.</LI>
				<LI>XContextMenu::DoUpdateMenu updates submenus.</LI>
				<LI>Added XCharEvent::WasAltKeyDown.</LI>
				<LI>XCursorUtils::ObscureCursor only spawns a thread if the cursor is visible.</LI>
				<LI>Instead of asm code the stack crawl code uses GetCurrentThread to get the program counter address.</LI>
				<LI>Whisper\Libraries\Win has been renamed Whisper\Libraries\Msvc.</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>XDocument::OnCanReplace will return true if the file being overwritten matches one of the doc 
  					storage types (instead of just matching the new file's type).</LI>
				<LI>Improved XTextBoxControl so that it correctly handles up and down arrow keys with multiple
  					line textboxes.</LI>
				<LI>Added support for submenus to XContextMenu. DoMenuSelect uses PopUpMenuSelect if the menu 
  				    has balloon help.</LI>
				<LI>XPreference uses CFPreferences on Carbon. (This is disabled since CFPreferences doesn't
  				    appear to work yet).</LI>
				<LI>ConvertToLowerCase, ConvertToUpperCase, and CompareStrings use the CFString routines in Carbon.
  				    (These are currently disabled since they don't seem to work properly with Unicode).</LI>
				<LI>Added CFString support to XString.</LI>
				<LI>Added XString::assign (const unsigned char*).</LI>
				<LI>Removed MAEDesc::GetDataHandle (can't implement on Carbon).</LI>
				<LI>Removed MAEDesc::MAEDesc (DescType, Handle) (poor fit on Carbon).</LI>
				<LI>Replaced the MAEList and MAERecord Handle ctors with ones that takes a void* and a size in bytes.</LI>
				<LI>Implemented wide string debug output methods on Pro 3.</LI>
				<LI>Added profiling support to XThread.</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added XUndoClosureCommand (this greatly reduces the need for custom XUndoableCommand objects).</LI>
			<LI>Added XColorSwatchControl.</LI>
			<LI>Added kInvalidFileSpec and kInvalidFolderSpec.</LI>
			<LI>Added XTransform (base class for transforming real numbers) and the following subclasses:
			    XIdentityTransform, XDegenerateTransform, XAddTransform, XMultiplyTransform, XInvertTransform, 
			    XExponentialTransform, XPowerTransform, and XCompositeTransform.</LI>
			<LI>Added XHSVColor.</LI>
			<LI>Added XColorSet and kWhisperColors, kCrayolaColors, kHTMLColors, and kNetscapeColors constants.</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>Added support for control mnemonics.</LI>
			</UL> 

			<LI>Mac</LI>
			<UL> 
				<LI>Added a template XCFObject to automatically manage the ref counts for Carbon objects.</LI>
			</UL> 
		</UL> 



	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.2.1</H2>
			</TH>
			<TD>
				<H2>June 22, 1999</H2>
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>XScrollableControl doesn't properly draw nested controls. (Fixing this isn't entirely
				  straight forward: see Design Notes.txt for more details)</LI>
				<LI>Whisper maximizes windows differently than other Windows applications I've
				  looked at: if the window has a maximum size the window is grown to that size
				  instead of to fill the entire monitor. IMO this is way better than filling
				  an entire monitor with completely useless dead space, but the size grip and
				  the resize borders don't work when the window is maximized. I haven't been
				  able to find an app that sensibly maximizes windows so I'm not sure if this
				  is a Whisper bug or an OS limitation.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
				<LI>Controls inside tab controls aren't drawn in gray when disabled or deactivated (this is yet another AM 1.1 bug).</LI>
			</UL>
		</UL>

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Fixed several XTree syntax errors.</LI>
			<LI>XTree::AddChildToLeft, AddChildToRight, and RemoveChild correctly update mCount when the 
  			subtree has more than one node.</LI>
			<LI>Shuffled BEGIN_NAMESPACE and END_NAMESPACE about in XNewAndDelete.cpp so the file 
  			compiles with WHISPER_OPERATOR_NEW set to 0.</LI>
  
			<LI>Mac</LI>
			<UL> 
				<LI>XThread::Sleep was only using the delay argument with the main thread.</LI> 
				<LI>XApplication::DoReportError uses \r instead of \n.</LI> 
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>XFileDialogOptions ctor sets nMaxCustFilter and nMaxFile using characters instead of bytes.</LI>
				<LI>XFileSystem::IsValidName and GetValidName allow printable Unicode characters on NTFS.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 
			<LI>Disabled the "Implicit Conversion Warning" in the Whisper CodeWarrior project.</LI>
			<LI>Disabled the "Generate SYM File" CodeWarrior option in the Whisper project.</LI>
			<LI>Disabled the "Don't Reuse Strings" CodeWarrior option in the Whisper project.</LI>
			<LI>Enabled the "Save project entries using relative paths" CodeWarrior option in all projects.</LI>
			<LI>Example projects enable the "Pool Strings" CodeWarrior option.</LI>
			<LI>STD is defined to be nothing on MSVC 6.</LI>
			<LI>Wrapped #pragma mark's using #if __MWERKS__ (instead of #if MAC).</LI>
			<LI>Added XDocApplication::GetOSFrameWindow (returns nil on Macs).</LI>
			<LI>Renamed XSafePtrMixIn XSafePtrMixin.</LI>
			<LI>Numerous minor changes for (unofficial) Pro 3 support.</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>XBaseDocument::HandleSaveAs strips leading and trailing spaces (per the Win 98 logo requirements).</LI>
				<LI>Removed an ASSERT in the WM_MDIACTIVATE case of XBaseWindow::HandleMessage.</LI>
				<LI>Added XFileDialogOptions::SetDefaultFolder.</LI> 
				<LI>XFileDialogOptions defaults to starting at "My Documents" (per the Win 98 logo requirements).</LI>
				<LI>XFileDialog::SaveFile uses the initial directory preference.</LI>
				<LI>Added XFileSystem::IsFAT and IsNTFS.</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>FragInit calls __initialize if MULTI_FRAGMENT_APP is set and calls InitializeToolbox if APP_TARGET is set.</LI>
				<LI>XInvariantMixin::Invariant checks for 2-byte alignment on 68K's and checks for object in low mem on Macs.</LI>
			</UL> 
		</UL> 

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.2</H2>
			</TH>
			<TD>
				<H2>June 15, 1999</H2>
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>XScrollableControl doesn't properly draw nested controls. (Fixing this isn't entirely
				  straight forward: see Design Notes.txt for more details)</LI>
				<LI>Whisper maximizes windows differently than other Windows applications I've
				  looked at: if the window has a maximum size the window is grown to that size
				  instead of to fill the entire monitor. IMO this is way better than filling
				  an entire monitor with completely useless dead space, but the size grip and
				  the resize borders don't work when the window is maximized. I haven't been
				  able to find an app that sensibly maximizes windows so I'm not sure if this
				  is a Whisper bug or an OS limitation.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
				<LI>Controls inside tab controls aren't drawn in gray when disabled or deactivated (this is yet another AM 1.1 bug).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>This version of Whisper is the first to support threads. I believe that apart from the UI elements
			(menus, windows, and controls) Whisper is fully thread safe. Note that with MSVC you should switch over
			to the multi-threaded version of the C libraries (you'll get a linker warning if you forget to do this).</LI>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Whisper 1.1 was incorrectly using the wide string formatting specifiers. The way this
			  is supposed to work (eg with wprintf) is as follows:
			    <PRE>
	"%s" takes a char* which it treats as a multi-byte character array and converts to a wide string
	"$ls" takes a wchar_t* which it copies to the output </PRE>
			  
			  <P>However MSVC 5 seems to treat the "%s" case as if the argument were a wide string which
			  is, I think, incorrect: according to the ISO C standard a single zero byte in a multi-byte
			  string terminates the string so wide strings cannot be multi-byte strings. CodeWarrior
			  Pro 4's support for wide string IO was very buggy so I used my own version which fixed 
			  most of the bugs (see Mvswprintf.cpp). Unfortunately I was under the impression that
			  MSVC was doing the right thing so, it too, expects the "%s" argument to be a wide string.
			  CodeWarrior Pro 5 seems to do the right thing. Here's an example of how this all plays out:
			    <PRE>
	TRACE(L"testing %ls\n", L"1..2..3");
	TRACE(L"completed %s\n", "test");
	TRACE(L"%s\n", L"has bugs");		// non-standard  </PRE>
			  
			  <P>MSVC 5 prints garbage for the second TRACE and incorrectly prints "has bugs" in the
			  third case. Pro 4 has exactly the same behavior (I had to tweak Mvswprintf.cpp to
			  allow "%ls"). Pro 5 handles all three lines correctly (note that Mvswprintf.cpp isn't used in Pro 5).
			  IMO the best way to handle this mess is to always use "%ls" when printing strings in
			  Whisper.</LI>
			<LI>XApplication::HandleQuit does nothing if the app is already quitting.</LI>
			<LI>XControl::HandleShow and HandleHide work if the parent control is hidden.</LI>
			<LI>Replaced the ignoreCase arguments in XSimpleParser with useCase arguments (the ignoreCase arguments were all messed up).</LI>
			<LI>Fixed a bug in XMemoryHeap that prevented leak count reporting when mUseStackCrawl was false.</LI>
			<LI>Fixed spelling of Separator XML menu element.</LI>
			<LI>Corrected XSeperatorControl spelling.</LI>
			<LI>Corrected spelling of "separator" in XMenu and XPopupMenuControl.</LI>
			<LI>Fixed spelling of kPathSeparator.</LI>
			<LI>Added XNumericConversions.cpp to the CW Whisper project (and fixed a syntax error).</LI>
  
			<LI>Mac</LI>
			<UL> 
				<LI>AskSaveChanges and AskRevertChanges pass the correct arguments to NavServices.</LI>
				<LI>Tweaked MEventDispatcher::HandleMenuClick so it does a better job of updating
  				the menus when modifier keys affect menu items.</LI>
				<LI>XWindow no longer uses FindControlUnderMouse (didn't work with controls embedded within 
				XScrollableControls).</LI>
				<LI>Fixed XRangedControl::OnSetMinMaxValues so that it works correctly when 32-bit mapping 
  				toggles on and off.</LI>
				<LI>XRangedControl::DoMapLongToShort and DoMapShortToLong round instead of truncating.</LI>
				<LI>XRangedControl ASSERTs check that values are within an error range instead of checking
				  for equality.</LI>
				<LI>Added an ugly SetControlVisibility work-around to XNestableControl::HandleDraw (SetControlVisibility
				doesn't seem to work correctly with deeply nested embedding hierachies).</LI>
				<LI>SetIfColor and SetIfBkColor no longer check for color ports (RGBForeColor will do the right 
  				thing if the port is black and white) and no longer check the port's current color (this code was swiped 
  				from MacApp and didn't work because XRGBColor uses floats).</LI>
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>GetWorkWindow uses WS_EX_TOOLWINDOW so it no longer appears in the taskbar.</LI>
				<LI>GetProcAddress is used when calling the wide versions of SHGetFileInfo, 
				  SHGetPathFromIDList, and SHBrowseForFolder (these functions are only present on
				  Win 95 if the active desktop update is installed).</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 
			<LI>XDropApp is now threaded and uses a progress dialog.</LI>
			<LI>Added XApplication::OnPostInit.</LI>
			<LI>Renamed kCenterOnParentWindow kCenterOnTopWindow, kAlertPositionOnParentWindow kAlertPositionOnTopWindow,
  			and kStaggerOnParentWindow kStaggerOnTopWindow.</LI>
			<LI>Removed XValueControlClickExtension (this was already obsolete in the last Whisper version).</LI>
			<LI>Renamed XContextMenu::Post Execute.</LI>
			<LI>XDeferredErrorCommand takes an exception pointer instead of a reference (makes it easier to use with catch all blocks).</LI>
			<LI>Moved IsWritable from MFileSystem to XFileSystem and implemented on Windows.</LI>
			<LI>Rewrote XFileFilter to use the new XFileType class.</LI>
			<LI>The types used by XFileDialog when opening and saving are specified in XFileDialogOptions 
  			using XFileType objects.</LI>
			<LI>XFileFilter and XFolderFilter now descend from XReferenceCountedMixin.</LI>
			<LI>Added XFileSpec::ReadMetaData and SaveMetaData (on the Mac these will use the resource fork, on
			NTFS they will use streams, on FAT they're no-ops).</LI>
			<LI>Renamed XXMLDocument XXMLDoc.</LI>
			<LI>XXMLAttribute::GetInt32Value, GetUInt32Value, GetFloatValue and GetDoubleValue have 
  			optional min and max arguments.</LI>
			<LI>XXMLParser allows ISO names to be used for US-ASCII, utf-8, and utf-16 encoding names.</LI>
			<LI>XUTF8Transcoder will do a proper conversion if OS support is missing (as it will be on
  			Win 95 or a Mac without TEC).</LI>
			<LI>Added XMenu::AppendFonts.</LI> 
			<LI>Replaced XFunctor0ClickExtension, XFunctor1ClickExtension, and XFunctor2ClickExtension with XClosureClickExtension.</LI>
			<LI>Renamed XTimerMixIn XTimerMixin.</LI>
			<LI>XCountedPtr's can now be compared with const T*'s.</LI>
			<LI>Removed UnicodeMapper example from the distribution.</LI>			
			<LI>XTypes.h enables the const_strings pragma on CW 5 and above (this corrects a hole in C's type system that allowed
			string literals to be assigned to non-const pointers).</LI>
			<LI>Updated zlib and png libraries to the latest versions (there weren't any major changes,
  			the most important seems to be a fix of a rare inflate bug in zlib).</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>Added Intel target to DropCount's CodeWarrior project.</LI>
				<LI>OutputDebugString is now used with CodeWarrior (this will be a no-op if you don't have the "Log System Messages" pref checked).</LI>
				<LI>Minimized LockWindowUpdate usage (which causes lot's of flashing with NT 4).</LI>
				<LI>Added XPixMap::CreateCompatibleBitmap.</LI>				
				<LI>No longer uses MB_ICONQUESTION.</LI>
				<LI>Implemented ObscureCursor on Windows.</LI>
				<LI>Replaced /GX with /EHs in all MSVC projects. This generates smaller code and means
  				that catch(...) will no longer catch structured exceptions (at least sometimes).</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>XWindow::OnDeactivating no longer calls StopIdling (the Mac OS 8 HU guidelines don't discuss
  				this but the Finder idles inactive windows).</LI>
				<LI>Added XMenu::SetFont.</LI>
				<LI>Worked around an Apple bug that prevented balloon help in menus from working after a Nav
 				 Services dialog was invoked. (The fix is in XMenu::DoRebuildHelpMenu).</LI>
				<LI>In debug builds ReportError will convert error codes to strings using a table in WhisperDebug.r 
				if the error code isn't first found in WhisperStrings.xml. This table contains 1579 error codes which 
				should be every error in the Universal Headers.</LI>
				<LI>Added MFileSystem::IsInTrash.</LI>
				<LI>Added TARGET_CARBON MSetPort overloads for WindowRef and DialogRef.</LI>
				<LI>Tweaked the CodeWarrior access paths so they're a bit simpler (and hopefully work better with Carbon).</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added support for document oriented apps (defaults to using MDI on Windows).</LI>
			<LI>Added IconEdit example app. This is similar to the Raven/MacApp example of the same name. One notable difference
			is that XDocApplication makes it very easy to support different persistence mechanisms. IconEdit takes advantage of
			this and can save/load using either XML or a binary stream.</LI>
			<LI>Added XThread, XCriticalSection, XMutex, XSemaphore, some stack based lockers, and XAtomicCounter. Note that
			threads are currently always cooperative on Macs and always preemptive on Windows.</LI>
			<LI>Added XIOU (this is a class that simplifies using a thread to compute a result).</LI>
			<LI>Added XPersistentWindow (abstract base class for windows that save their position and size).</LI>
			<LI>Added XTabLikeControl and XTabControl.</LI>
			<LI>Added XBevelButtonControl (this is a button that draws text, an icon, or a pixmap and can
  			include an optional menu).</LI>
			<LI>Added XRGBColor::Pick which will popup an OS color picker dialog.</LI>
			<LI>Added XControlExtension and XInputTargetExtension debug extensions.</LI>
			<LI>Added an XXMLDocVisitor class. Added XXMLPrintDoc subclass to convert an XXMLDoc to a string.</LI>
			<LI>Added XFileType to specify files by extensions and/or type/creator codes.</LI>
			<LI>Added XFSM (this is a templatized finite state machine class).</LI>
			<LI>Added XClosure. This uses the handle/body idiom to encapsulate a function call (using a callback object
			and a fixed set of arguments). Closures are created using the MakeClosure functions in XClosures.h</LI>
			<LI>Added XClosureCommand.</LI> 
			<LI>Added GetErrorText(const std::exception*) to XMiscUtils.h.</LI>
			
			<LI>Mac</LI>
			<UL> 
				<LI>Added some new Mac-only cursors: kOpenHandCursor, kClosedHandCursor, kEyeDropperCursor, kBrushCursor, and kPencilCursor.</LI>
			</UL> 
		</UL> 

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.1</H2>
			</TH>
			<TD>
				<H2>April 23, 1999</H2>
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>In the Muscle example clicking the radio buttons in the pref dialog causes other
			  	  windows to redraw.</LI>
				<LI>XScrollableControl doesn't properly draw nested controls. (Fixing this isn't entirely
				  straight forward: see Design Notes.txt for more details)</LI>
				<LI>The NT 4 and Win98 utf-8 conversion functions don't handle surrogates. (This
				  is generally harmless, but does mean three of the files in xmltest\valid\sa
				  will fail the XXMLParser unit test).</LI>
				<LI>Whisper maximizes windows differently than other Windows applications I've
				  looked at: if the window has a maximum size the window is grown to that size
				  instead of to fill the entire monitor. IMO this is way better than filling
				  an entire monitor with completely useless dead space, but the size grip and
				  the resize borders don't work when the window is maximized. I haven't been
				  able to find an app that sensibly maximizes windows so I'm not sure if this
				  is a Whisper bug or an OS limitation.</LI>
				<LI>The stack crawl code doesn't produce anything usable when CodeWarrior is used
				  (apparently the code generated by CodeWarrior is incompatible with the SDK's StackWalk function).</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>Whisper can now be compiled using the Windows version of CodeWarrior (see Install.txt for more details).</LI>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>I've changed the way that Whisper handles notifications. Whisper 1.0 used two notification mechanisms.
			    The most common was via a broadcaster, for example when a button was clicked or the user changed a
			    textbox the control would broadcast a message. The second was via virtual functions. For example,
			    XTextBoxControl would call OnRejected if the user tried to type or paste too much text into a limited
			    length textbox. 
			    
			    <P>This worked fairly well, but could get rather cumbersome if an object had to listen to multiple
			    broadcasters. For Whisper 1.1 I've implemented a nicer and more flexible scheme using <A HREF="mailto:rich@rcsworks.com">Rich Hickey's</A> 
			    callback library and XClickExtensions.
			    
			    <P>The callback library is a set of template classes that allow you to wrap up a C-style function 
			    pointer or a member-function pointer into a light-weight functor object. For example if you want
			    to change the way a textbox control handles rejected text you could do something like this:
			    <PRE>
	static void HandleRejectedText(XTextBoxControl* textbox, const XString& rejected)
	{
		// popup an alert
	}
	
	XTextBoxControl::RejectCallback functor(makeFunctor((XTextBoxControl::RejectCallback*) nil, HandleRejectedText));
	mTextBox->SetRejectedCallback(functor);	</PRE>
	
			    <P>or you can use a member function: 
			    <PRE>
	XTextBoxControl::RejectCallback functor(makeFunctor((XTextBoxControl::RejectCallback*) nil, *this, &CApp::DoRejectedText));
	mTextBox->SetRejectedCallback(functor);		</PRE>

			    <P>(the first argument to makeFunctor is a work-around for compilers without template member functions).
			    		    
			    <P> Controls could rely solely on callback objects for notification, but I thought that this wasn't
			    quite flexible enough (the biggest drawback is that this would make it difficult to have multiple
			    objects respond to a control click). So, you can now attach XClickExtension's to controls. There are
			    concrete XClickExtension's to post an XCommand, send a MenuCommand to a specified XInputTargetMixin,
			    or call a functor using zero, one, or two arguments (these arguments are specified when the extension
			    is created). This turns out to be much nicer than broadcasting and has the added bonus of working with
			    any control: not just the ones that used to broadcast.</LI>
			<LI>I've made significant changes to the object streaming code:</LI>
			<UL> 
				<LI>Formerly objects could be streamed in and out using XReanimatableMixin and the XReanimator 
					singleton. Both of these classes have been dropped. In their place there's an XCreateByNameMixin 
					and an XObjectFactory singleton. This is a more cohesive design since these objects don't deal 
					with streaming. Objects can now be streamed using XBinaryPersistentMixin or XXMLPersistentMixin.</LI>
				<LI>XBinaryPersistentMixin::OnStreamIn no longer includes a version argument. This was a good idea,
				 	but in practice all it provided was a false sense of security. Instead of using a single version
				 	number for an entire object stream each node in the inheritance graph should have it's own version
				 	number.</LI>
				 <LI>Eliminated XStreamableMixin.</LI>
				 <LI>Renamed XInStream::Resurrect Unflatten.</LI>
				 <LI>Moved the Streams folder from HighLevel to Core.</LI>
			</UL> 
			<LI>By default, Whisper replaces the global operator new. There are two major reasons for this: 1) Neither
			    the Mac nor the Windows compilers do a very good job tracking leaks. In both cases they store file and
			    line numbers using the preprocessor. Whisper, on the other hand, stores eight frames of the stack (for
			    an extra 32-bytes per block in debug builds). If the block leaks the stack frames are translated into
			    function names and offsets. I've found this extra information very helpful when tracking down leaks.
			    2) Historically the Mac and Win compilers have had rather poor allocators (although MSVC seems to be
			    getting better). Whisper handles this by putting essentially all the debugging code into XMemoryHeap
			    and relying on XAllocator objects to allocate the memory. The idea was that this would allow any
			    allocator to be dropped in without sacrificing niceties like the stack crawl or block over and underrun
			    checks.
			    
			    <P>Unfortunately XAllocator assumed that it was possible to use the allocator to do things like walk
			    the heap or get information about a block. This turns out to be a bad assumption: lot's of good allocators
			    take a rather no frills approach to their APIs. So, what I've done is pare the XAllocator interface
			    down to a bare minimum and rely more on XMemoryHeap. This is good because it makes it easy to drop
			    in a new allocator, but bad because debug blocks are now 8-bytes larger (for heap walking) and the
			    XMemoryHeap statistics functions no longer special case huge blocks (which makes fine-tuning the
			    initial heap size considerably more difficult).
			<LI>I made an attempt to merge the OnKeyDown and OnChar functions into a single function, but I had to
			    back out of the changes because I couldn't come up with a satisfactory implementation on Windows.
			    However I have dropped the OnKeyUp methods. These are little used and just too weird on Windows (eg
			    for a recognized diacritical character Windows can send two WM_KEYDOWN messages, but three WM_KEYUP
			    messages!).</LI>
			<LI>XDialogHandler now includes a Pose method. This simplifies its usage but may require some changes 
			    to client code. See XDialogHandler.h for a usage example.</LI>
			<LI>The XML parser's handling of ID attributes was rather poor. I've made two changes: 1) instead of
				XXMLDTD, XXMLParser checks for unique IDs 2) IDs are looked up using XXMLDocument instead of
				XXMLDTD.</LI>
			<LI>ZTraceFile::Print compensates if the file name is too long.</LI>
			<LI>Added missing translations for " copy (duplicate file)" and "Select (file) '#1'" to WhisperStrings.xml</LI>
			<LI>Rewrote the XAllocator fragmented heap test to work better with allocators that don't
  				release empty pools to the OS.</LI>
  			<LI>XImageSink::ColorToPixel now works correctly.</LI>
  
			<LI>Mac</LI>
			<UL> 
				<LI>Windows are now deactivated when the app is suspended.</LI>
				<LI>Fixed the hack in XDialogBox::HandleShow so that it no longer enables the default button if it's disabled.</LI>
				<LI>XControl::OnKeyDown only returns true if HandleControlKey doesn't return kControlNoPart.</LI>
				<LI>XValueControl::GetValue wasn't using GetControl32BitValue.</LI>
				<LI>Fixed the XPushButtonControl::MakeDefaultButton and MakeCancelButton post conditions.</LI>
				<LI>XPushButtonControl ctors set mDrawOutset (so focus rings get invalidated).</LI>
				<LI>XMenu (XString) ctor strips ampersands.</LI>
				<LI>XTextTranscoders.cpp was calling CreateTextEncoding without checking for the Text Encoding Converter.</LI>
				<LI>Added missing StandardFile 'DLOG' resources that include prompt strings.</LI>
				<LI>Strings with fancy quotes are no longer wide strings (so they'll be properly converted to Unicode).</LI>
				<LI>Fixed XBrush::XBrush(XPixMap, EDrawMode) so that it works if depth is greater than 8.</LI>
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>Added missing XTextBoxControl backspace and forward delete undo code (Whisper does this itself in
				   order to support multi-level undo/redo).</LI>
				<LI>Rewrote the XMenu accelerator text generation code to correctly handle multiple modifier keys.</LI>
				<LI>XMenu only calls RebuildAcceleratorTable if the menubar is the active menubar.</LI>
				<LI>Fixed a bug in WRegistryKey::ReadHandle that was introduced after adding code to use the wide 
				    interfaces under NT.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 
			<LI>Added CODE_WARRIOR and MSVC defines to XWhisperHeader.h (the only suitable symbol MSVC 
  				pre-defines is _MSC_VER and CodeWarrior winds up defining this).</LI>
  			<LI>Added XDrawExtension::mEnabled to allow draw extensions to draw differently if their owner is disabled.</LI>
  			<LI>Line and frame draw extensions default to using a gray pen when their owner is disabled.</LI>
			<LI>Added XKeyDownEvent::ComputeChar and XCharEvent::ComputeKey. These aren't 100% reliable on
			    Windows, but they do make the ugly way that Windows handles keyboard messages a bit easier
			    to deal with.</LI>
			<LI>Added XKeyDownEvent::GetRepeatDelay. Implemented GetRepeatCount on Windows.</LI>
			<LI>Added an XMenuBar ctor that takes a XML uri and a list of menus.</L1>
			<LI>XMenu and XPopupMenuControl::InsertSortedItem return the index of the new item.</LI>
			<LI>Help messages can now be specified when items are added to an XMenu.</LI>
			<LI>Debug extensions include help messages when they add items to the Debug menu.</LI>
			<LI>ZContentParser::Parse and DoParseCDSection handle #PCDATA and CDATA sections more efficiently.</LI>
			<LI>XURI handles "." and ".." when merging paths.</LI>
			<LI>Renamed StrToUpperStr ConvertToUpperCase. Renamed StrToLowerStr ConvertToUpperCase. Added overloads 
			    that take XChar's.</LI>
			<LI>Renamed Strip(XString, XString) StripLeading</LI>
			<LI>Added Remove (XString, XString) and Remove (XString, XChar).</LI>
			<LI>XString::DoSetDirty builds mCData if __MWERKS__ (instead of if MAC).</LI>
			<LI>Added XArray and XTinyVector streaming methods.</LI>
			<LI>Made the XSafePtr ctor explicit (the ctor and dtor are non-trivial so it seems like a good
  				idea to eliminate implicit temporaries).</LI>
  			<LI>Added XXMLElement::attr_front, attr_back, item_front, and item_back.</LI>
  			<LI>Added XXMLAttribute ctor overloads for the most common primitive types.</LI>
  			<LI>Fixed mis-spellings of "grammar".</LI>
  			<LI>XMemoryHeap now allows for an arbitrary number of trailer bytes.</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>MAC is now undefined on Windows (this works better with MSVC 6).</LI>
				<LI>XBaseWindow includes hooks to support displaying help messages as menus are selected.</LI>
				<LI>Added checks to XMenuBar and XMenu to ASSERT that mnemonics are unique.</LI>
				<LI>Muscle's WMain.cpp disables stack crawl on NT. (This used to be disabled only for Win95, but
				    despite being considerably faster than Win 95 the NT stack walker still noticably slows
				    down code that does a lot of heap allocations. If you have leaks on Windows you can enable
				    this to get a stack crawl for each leak.)</LI>
				<LI>XSimpleAllocator aligns blocks to 8-bytes.</LI>
				<LI>TRACE uses a console window when running without a debugger.</LI>
				<LI>Muscle defaults to using the new XMallocAllocator.</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>Removed code to create an XMenu from a Mac resource (XML resources are now used instead).</LI>
				<LI>Moved WasCapsLockDown, WasCommandKeyDown, and WasOptionKeyDown from XMouseEvent to XEvent.</LI>
				<LI>InitializeToolbox no longer calls InitFloatingWindows if running under 8.5.</LI>
				<LI>Added an XRGBColor ctor taking a ThemeBrush.</LI>
				<LI>MSystemInfo::HasFloatingWindows returns false if the system version is less than 8.6.</LI>
  				<LI>CodeWarrior Whisper library names no longer include slashes (causes problems when running on Windows).</LI>
				<LI>Muscle defaults to using the new MHeapManagerAllocator.</LI>
				<LI>I've disabled the implicit arithmetic conversion warning for all targets in all the projects (I'm
				  still enabling this during development but it caused a lot of problems for other people because it
				  requires tweaks to MSL).</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added XListBoxControl.</LI>
			<LI>Added XProgressBarControl.</LI>
			<LI>Added XXMLPersistentMixin.</LI>
			<LI>Added XMemoryMappedFile.</LI>
			<LI>Added XMallocAllocator (this uses malloc to allocate memory).</LI>
			<LI>Added MHeapManagerAllocator (this uses <A HREF="http://www.biit.com">HeapManager</A> to allocate memory).</LI>
			<LI>Added MBestFitAllocator (this uses MacApp's BestFitHeap to allocate memory). Because of licensing issues
			    BestFitHeap is not included in the distribution (although it's pretty easy to get working with Whisper).</LI>
			<LI>Added XOptimize.h (this is used to enable optimizations for speed critical files in debug builds).</LI>
		</UL> 

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.0</H2>
			</TH>
			<TD>
				<H2>March 13, 1999</H2>
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>In the Muscle example clicking the radio buttons in the pref dialog causes other
			  	  windows to redraw.</LI>
				<LI>XScrollableControl doesn't properly draw nested controls. (Fixing this isn't entirely
				  straight forward: see Design Notes.txt for more details)</LI>
				<LI>The NT 4 and Win98 utf-8 conversion functions don't handle surrogates. (This
				  is generally harmless, but does mean three of the files in xmltest\valid\sa
				  will fail the XXMLParser unit test).</LI>
				<LI>Whisper maximizes windows differently than other Windows applications I've
				  looked at: if the window has a maximum size the window is grown to that size
				  instead of to fill the entire monitor. IMO this is way better than filling
				  an entire monitor with completely useless dead space, but the size grip and
				  the resize borders don't work when the window is maximized. I haven't been
				  able to find an app that sensibly maximizes windows so I'm not sure if this
				  is a Whisper bug or an OS limitation.</LI>
			</UL>
		
			<LI>Mac</LI>
			<UL> 
				<LI>The stack crawl code has no symbols if outlined traceback symbols are used.</LI>
				<LI>The unmangle routine supplied by Apple in the 3.2 Universal Headers isn't handling 
			 	  namespaces very well so I've disabled it (HeapManager has some unmangle code that 
			 	  may be worth using but it's copyrighted and somewhat icky).</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>Whisper is designed around the assumption that Unicode will be the preferred way
			  to handle text on future operating systems (this is already the case for NT 4).
			  Earlier versions of Whisper were written with this in mind, eg XString used wchar_t
			  for characters and provided c_str(), w_str(), and t_str() member functions to access
			  the text. However Unicode wasn't truly supported: characters were simply treated as
			  wider char's.
			  
			  <P>This has now changed. Whisper is, I think, fully Unicode savvy. It includes transcoder
			  objects to convert between 16-bit Unicode (utf-16), utf-8, US-ASCII, Mac OS Roman,
			  and Win Latin 1. All of these transcoders work on all platforms (except Mac OS 7
			  where the Text Encoding Manager may not be installed in which case a naive
			  algorithm is used). In addition XStringUtils.h includes a superset of the C
			  isalnum, isalpha, isdigit, etc functions. These functions are implemented using
			  binary searches on 12K worth of machine generated tables from the Unicode 2.0 
			  character database. Also StrToUpperStr and StrToLowerStr have been rewritten. On
			  NT these will use LCMapStringW. On Win 95 and the Mac they use one of the machine
			  generated tables.
			  
			  <P>One other noteworthy feature is that the same Whisper binary will use the Unicode
			  APIs on Win NT and the ANSI APIs on Win 95. For example, instead of
				<PRE>	OutputDebugString(mesg.t_str());</PRE>
			  <P>Whisper uses
				<PRE>
	if (WSystemInfo::HasUnicode())
	   OutputDebugStringW(mesg.w_str());		
	else
	   OutputDebugStringA(mesg.c_str());
				</PRE>
			  This is counter to the usual practice of keying off the _UNICODE macro and goes
			  against the grain of the Win32 API, but it's really nice to only have to worry
			  about a single binary.</LI>
		</UL> 

		<H4>Bug Fixes and Design Changes</H4>
		<UL> 
			<LI>Prior versions of Whisper included a class called XUseContext. This was a rather 
			  poorly thought out class that set the global port on Macs and initialized the OS 
			  context with the XDrawContext members. I've ditched this class in favor of an
			  altogether simpler design. XDrawContext is now a thinner wrapper around an OS context:
			  it no longer contains members for the origin or the clip region. When XDrawContext
			  has to deal with these it goes straight to the OS context. When drawing takes place
			  on the Mac the Mac only routine XDrawContext::MakeCurrent is called to set the port.
			  This is a simpler design and should work well with QDe.</LI>
			<LI>XDropApp::HandleInit no longer pops up an alert if an XCancelException is caught.</LI>
			<LI>XBaseWindow::HandleOpen deletes the window if an exception is thrown (using 
			  XDeferredDeleteCommand).</LI>
			<LI>XPopupMenuControl::GetValue returns LONG_MAX if there's no selection.</LI>
			<LI>Fixed some minor compile errors in XSparseArray, XSet, and XTree.</LI>
			<LI>XScanner::Advance correctly updates mLine if the text has Unix style line endings.</LI>
			<LI>XScanner::OnSkipWhiteSpace properly handles character codes larger than 255.</LI>
			<LI>Fixed a bug that could cause XFileSystem::GetValidName to index past the end of the file
		      name if the number of characters to drop was odd.</LI>
			<LI>XString methods that take a char* or XChar* and a length now have duplicate methods without 
		      the length argument (this corresponds to the standard and means we no longer attempt to find 
		      the length of a possibly unterminated string).</LI>
			<LI>XMemoryHeap::Allocate and Deallocate were adding and subtracting slightly different 
		      values to mHugeBytes.</LI>
			
			<LI>Mac</LI>
			<UL> 
				<LI>Fixed XUserControl so that it can have the focus.</LI>
				<LI>XInputTargetMixin and XContextMenu weren't setting menu item styles.</LI>
				<LI>XFont::GetMetrics and GetStringSize weren't selecting the font into the port.</LI>
				<LI>The XTextShape::Draw method taking a rectangle wasn't properly handling kDefaultAlign.</LI>
				<LI>XTextShape was calling StyledLineBreak with an int when a Fixed was expected.</LI>
				<LI>XFileSystem::FileExists and FolderExists now work properly with empty FSSpecs.</LI>
				<LI>Fixed MSystemInfo::GetQuickTimeVersion.</LI>
				<LI>Rewrote the stack crawl code's GetMem function using an OS exception handler. (This
				   code is from <A HREF="mailto:bfitz@acm.org">Brian Fitzgerald</A> and allows the stack
				   crawl code to include symbols when virtual memory is on).</LI>
			</UL> 
				
			<LI>Win</LI>
			<UL> 
				<LI>XBaseWindow used to register a single window class. This caused problems since the
				  window class includes a bunch of information that can differ between window instances.
				  XBaseWindow now registers new window classes depending on SWindowStyle::classStyle and 
				  iconID.</LI>
				<LI>XFile::SetLength restores the original file pointer position.</LI>
			</UL> 
		</UL> 
		
		<H4>Changes</H4>
		<UL> 
			<LI>Replaced the XApplication hogging processor flag with a sleep time.</LI>
			<LI>Added XDropApp::mAcceptsFiles. XDropApp subclasses need to set this if they can work 
			  with individual files. (This allows for more control of which dialog pops up when the 
			  app is launched via a double click).</LI>
			<LI>XUserControl ctor now has a wantsFocus flag.</LI>
			<LI>XControl::OnContextMenu returns an XContextMenu* instead of a bool (this makes it 
			  easier for a subclass to extend a base class's context menu).</LI>
			<LI>XDrawContext saves and restores the old origin and clip region.</LI>
			<LI>Exceptions thrown by XFile include the file name.</LI>
			<LI>Nuked XReanimatableMixin::HandleReanimated and OnReanimated (these belong in XControl).</LI>
			<LI>Made XFile, XInFileStream, XOutFileStream, XInHandleStream, and XOutHandleStream 
			  ctors explicit.</LI>
			<LI>Instead of returning a uint64 XFile::GetLength and GetPosition return a uint32 (this
			  is usually all that client code is prepared to handle). People dealing with large
			  files can use the new GetLength64 and GetPosition64 functions.</LI>
			<LI>I've disabled the post-fix XFileIterator::operator++ (this was done because the XFileIterator
			  copy constructor can be very slow on Windows).</LI>
			<LI>XFileSystem::RenameFile and RenameFolder no longer modify the spec argument.</LI>
			<LI>XString uses XTextTranscoder objects when converting to and from char*'s.</LI>
			<LI>Replaced kIsBigEndian with BIG_ENDIAN.</LI>
			<LI>GaussianRandom() now returns a number on the real number line and allows the variance 
			  to be specified.</LI>
			<LI>Added GaussianRandom (double, double) to return a random number in a specified range.</LI>
			<LI>Added XPoint and XSize::operator*=(int32) and operator/=(int32).</LI>
			<LI>Added XFont::HasSize.</LI>
			<LI>Added XImageSink::GetAlphaMask, GetRedMask, GetGreenMask, and GetBlueMask.</LI>
			<LI>Added XBrush::SetDrawMode and some platform specific XBrush ctors.</LI>
			<LI>Added XPen::SetDrawMode and some platform specific XPen ctors.</LI>
			<LI>Disabled the XPen ctor taking an XPixMap (contrary to all the documentation ExtCreatePen 
			  cannot be used with a DIB on Win98).</LI>
			<LI>Added XShape::MoveBy and MoveTo.</LI>
			<LI>Removed XBoundedShape.</LI>
			<LI>XRegionShape::Frame uses a brush instead of a pen (this is because GDI's FrameRgn
		      call is unlike <EM>every</EM>other frame method and uses a brush instead of a pen).</LI>
			<LI>Added kSelectionPens to XPen.h for drawing selection rectangles.</LI>
			<LI>Nuked the XPixMapContext in XPixMap.h, renamed XPixelMapContext in XDrawContexts.h 
			  XPixMapContext.</LI>
			<LI>XSimpleParser::ParseChars takes a XRegularExpression instead of an XString. (This was
		      done because it's much more efficient to reuse an XRegularExpression instead of building
		      a new one from scratch each time).</LI>
			<LI>XRegularExpression constants are XRegularExpression objects (instead of XStrings).</LI>
			<LI>StrToUpperStr and StrToLowerStr handle Unicode characters. On NT these use OS functions.
			  On the other platforms a table lookup is performed.</LI>
			<LI>StrToDouble accepts INFINITY as a synonym for INF.</LI>
			<LI>The floating point string conversion functions retrieve the decimal point character from the OS.</LI>
			<LI>CodeWarrior's debugger does a poor job displaying wide strings. To make life easier when
			  debugging XString::DoSetDirty sets mCData on the Macs in debug builds. DoSetDirty used
			  to do this by calling DoResetDirty which is no longer tenable since DoResetDirty now
			  uses transcoder objects and DoSetDirty can be called a *lot*. So, I've changed DoSetDirty
			  to do a quick and dirty conversion (the dirty flag remains set so the correct conversion
			  will be done when c_str() is called). As a further optimization I've added an mCDataCapacity
			  member so that DoSetDirty no longer deletes and reallocates mCData each time it's called
			  (this also speeds up DoResetDirty a bit on both platforms).</LI>
			<LI>Rewrote XString replace methods to be faster (they do all the work themselves instead of 
		      calling erase and insert).</LI>
		    <LI>LoadWhisperString and LoadAppString no longer fetch the string tables from an OS resource.
		      Instead they use a function pointer to return a table for a specified locale. XApplication
		      sets this function pointer and initializes the string table using an XML resource. The XML
		      resource can include an arbitrary number of translations for each string. This means that
		      the same binary can automatically switch to the correct language when it's started up. I've 
		      also created a drag and drop app that will search C++ files for LoadWhisperString or 
		      LoadAppString and update a specified XML string table.</LI>
			<LI>The TRACE and DEBUGSTR functions take wchar_t pointers instead of char pointers. I made
			  this change because it's a very good idea to get used to using wide string literals: because
			  they don't have to be converted via a transcoder they're much more efficient. Narrow string
			  literals should only be used when you want to invoke a transcoder (eg if you're using a character
			  outside the 7-bit ASCII range).</LI>
			
			<LI>Win</LI>
			<UL> 
				<LI>XBaseWindow::DoWindowProc and XControl::DoWindowProc use an XDeferredErrorCommand object
				   to popup an alert if an exception is thrown. </LI>
				<LI>Added a classStyle member to SWindowStyle.</LI>
				<LI>Implemented XPixMap.</LI>
				<LI>Implemented XBrush (XPixMap, EDrawMode).</LI>
				<LI>Implemented XPen (XPixMap, EDrawMode).</LI>
				<LI>Implemented WBMPImageSource.</LI>
				<LI>Can now create an XColorTable from an HPALETTE.</LI>
				<LI>XFileDialog::OpenFile, ChooseFile, and ChooseFolder start the user out at the directory 
				  at which he last selected an item. The old directory is saved in the registry using the 
				  (optional) XFileDialogOptions pref key. (This doesn't seem to work in NT 4)</LI>
				<LI>XFileDialog::ChooseFolder filters folders.</LI>
				<LI>IsDebuggerPresent uses code from the March 1999 Windows Developer's Journal on Win 95.</LI>
			</UL> 
			
			<LI>Mac</LI>
			<UL> 
				<LI>XControl caches the parent control. (Profiling indicated that using the toolbox 
				  to get the parent was a bottle neck)</LI>
				<LI>MyScrollRect (in XScrollableControl.cpp) uses ScrollRect instead of CopyBits (the erase 
				  to white is suppressed by temporarily installing an empty region bottleneck).</LI>
				<LI>MPictSource is now constructed using an XResource.</LI>
				<LI>Added XFont::GetFontNumber.</LI>
				<LI>ClearMemory uses BlockZero (this is about twice as fast as SetMemory or memset).</LI>
				<LI>Added MSystemInfo::HasTextEncodingConverter and GetTextEncodingConverterVersion.</LI>
				<LI>Tweaked XFileDialog::DoFilter so that it won't throw when Nav Services passes it 
				  broken aliases from the Recent Items folder (this was harmless, but quite annoying 
				  since it happened a lot).</LI>
			</UL> 
		</UL> 
	
		<H4>Additions</H4>
		<UL> 
			<LI>Added a validating XML parser (the only C/C++ XML parser I could find with a reasonable
		  	  license agreement is expat and that's not a validating parser).</LI>
			<LI>Added XScrollBarControl and XSliderControl.</LI>
			<LI>Added XScrollableControl and XScrollerControl.</LI>
			<LI>Added XPixMapControl.</LI>
			<LI>Added XTracker and XRubberBandTracker.</LI>
			<LI>Added XURI to represent a Uniform Resource Identifier, XURIFetcher which loads a URI
		  	  using a particular scheme (currently only "file" and "resource" are supported), XResource 
		  	  which contains the data from a URI, and XURIResolver which uses a list of XURIFetcher's to 
		  	  load a URI.</LI>
			<LI>Added XResource. Moved Resources folder into (Unused). XResource is a simple wrapper
			  around an XHandle that includes a URI for better error reporting. It also includes
			  OnLock and OnUnlock methods that can serve as the basis for fancier resource handling
			  (eg demand loading and/or purging).</LI>
			<LI>Added XGroupShape. This is used to draw a list of XShape objects.</LI>
			<LI>Added XPNGImageSource.</LI>
			<LI>Added the automata, parser, and regular expression classes from Raven.</LI>
			<LI>Added XInPointerStream and XOutPointerStream.</LI>
			<LI>Added XFont::iterator (iterates over all font names for a specified device).</LI> 
			<LI>Added kResizeLeftRightCursor and kResizeUpDownCursor</LI>
			<LI>Added MSystemInfoExtension and WSystemInfoExtension debug extensions.</LI>
			<LI>Added XSaveContext (this saves and restores the origin and clip region of a draw context).</LI>
			<LI>Added XDate. This is essentially a wrapper around the OS date objects, but also includes
			  methods for converting a date (or time) to a locale dependant string.</LI>
			<LI>Added XLocale. The default ctor initializes the object using the current user's OS locale.</LI>
			<LI>I've added overloads of LoadWhisperString and LoadAppString to better support localization
			  of dynamicly generated strings. These overloads take up to eight XString arguments and look
			  like this:
				<PRE>
	LoadAppString(L"The file '#1' contains #2 lines of code.", mItemName, UInt32ToStr(mNumLines));
				</PRE>
			  The first argument will appear in the XML string table. When it's translated the #1 and
			  #2 sub-strings will remain, but may appear at different locations. (The string literal
			  has an L prepended which means it's a wide string. This isn't strictly neccesary, but
			  is usually desirable since a transcoder doesn't have to be invoked when the literal is
			  converted to an XString).</LI>
			<LI>Added XTextTranscoder, XNaiveTranscoder, XASCIITranscoder, XMacRomanTranscoder, 
			  XWindowsLatin1Transcoder, and XUTF8Transcoder.</LI>	
			<LI>Added IsDigit, IsBinaryDigit, IsArabicDigit, IsHexDigit, IsNumeric, IsControl, IsLetter, 
			  IsIdeographic, IsAlphabetical, IsUpperCase, IsLowerCase, IsTitleCase, IsPunctuation, 
			  IsSymbol, IsMathSymbol, IsCurrencySymbol, IsWhiteSpace, IsCombining, IsPrivate, IsValid, 
			  and IsPrintable to XStringUtils.h.</LI>
			<LI>Added IsWhiteSpace(XString). </LI>
			<LI>Added CompareStrings to XStringUtils.h (for locale dependant collating).</LI>
			<LI>Added XSystemInfo::GetAppName.</LI>
			<LI>Added XDeferredErrorCommand. This can be used to defer displaying an error alert until it's
			   safe to do so.</LI>	
					
			<LI>Win</LI>
			<UL> 
				<LI>Added XFolderSpec::GetSystemFolder and GetWindowsFolder.</LI>
			</UL> 
		</UL> 

	<TABLE BORDER = 0 WIDTH = "100%">
		<TR>
			<TH VALIGN = baseline>
				<H2 ALIGN = LEFT>Whisper 1.0a1</H2>
			</TH>
			<TD>
				<H2>Dec 2, 1998</H2>
			</TD>
		</TR>
	</TABLE>
	
		<H4>Known Bugs</H4>
		<UL> 
			<LI>Win</LI>
			<UL> 
				<LI>In the Muscle example clicking the radio buttons in the pref dialog causes other
			  	  windows to redraw.</LI>
				<LI>All window close boxes are disabled after closing the pref dialog.</LI>
			</UL>
		</UL>

		<H4>General Notes</H4>
		<UL> 
			<LI>This is the first (semi) public release of Whisper.</LI>
		</UL> 
	  				 
<A HREF="Home.html">Return to the Whisper Home Page</A>
</BODY>

</HTML>

